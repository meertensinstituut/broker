<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Module processes
 */
if (! $authentication-&gt;accessBasedOnLogin ()) {
  $authentication-&gt;logout ();
  header ( &quot;Location: &quot; . $configuration-&gt;url ( &quot;login&quot;, &quot;processes&quot; ) );
} else {
  
  if (isset ( $_GET [&quot;suboperation&quot;] ) &amp;&amp; is_string ( $_GET [&quot;suboperation&quot;] ) &amp;&amp; trim ( $_GET [&quot;suboperation&quot;] ) != &quot;&quot;) {
    if (isset ( $_GET [&quot;subsuboperation&quot;] ) &amp;&amp; is_string ( $_GET [&quot;subsuboperation&quot;] ) &amp;&amp; trim ( $_GET [&quot;subsuboperation&quot;] ) != &quot;&quot;) {
      if(isset($configuration-&gt;solr) &amp;&amp; isset($configuration-&gt;solr[$_GET[&quot;subsuboperation&quot;]])) {
        $smarty-&gt;assign ( &quot;_processesConfiguration&quot;, $_GET [&quot;subsuboperation&quot;] );
      } else {
        header ( &quot;Location: &quot; . $configuration-&gt;url ( &quot;processes&quot;) );
        exit ();
      }      
      if ($_GET [&quot;suboperation&quot;] == &quot;running&quot;) {
        $smarty-&gt;assign ( &quot;_processesType&quot;, &quot;running&quot; );
      } else if ($_GET [&quot;suboperation&quot;] == &quot;history&quot;) {
        $smarty-&gt;assign ( &quot;_processesType&quot;, &quot;history&quot; );
      } else if ($_GET [&quot;suboperation&quot;] == &quot;error&quot;) {
        $smarty-&gt;assign ( &quot;_processesType&quot;, &quot;error&quot; );
      } else if ($_GET [&quot;suboperation&quot;] == &quot;api&quot;) {
        if (strtoupper ( $_SERVER ['REQUEST_METHOD'] ) == &quot;POST&quot;) {
          $response = array ();
          header ( &quot;Content-Type: application/json&quot; );
          if ($apiRequest = json_decode ( file_get_contents ( &quot;php://input&quot; ) )) {
            $response [&quot;status&quot;] = &quot;ok&quot;;
            if (! isset ( $apiRequest-&gt;type ) || ! is_string ( $apiRequest-&gt;type )) {
              $response [&quot;status&quot;] = &quot;error&quot;;
              $response [&quot;error&quot;] = &quot;no (valid) type in request&quot;;
            } if (! isset ( $apiRequest-&gt;configuration ) || ! is_string ( $apiRequest-&gt;configuration ) || !isset($configuration-&gt;config [&quot;solr&quot;] [$apiRequest-&gt;configuration])) {
              $response [&quot;status&quot;] = &quot;error&quot;;
              $response [&quot;error&quot;] = &quot;no (valid) configuration in request&quot;;
            } else if($configuration-&gt;solr[$apiRequest-&gt;configuration][&quot;mtasHandler&quot;]) {
              $coreUrl = $configuration-&gt;config [&quot;solr&quot;] [$apiRequest-&gt;configuration] [&quot;url&quot;].$configuration-&gt;solr[$apiRequest-&gt;configuration][&quot;mtasHandler&quot;];
              $ch = curl_init ( $coreUrl . &quot;?action=&quot;.urlencode($apiRequest-&gt;type) );
              $options = array (
                  CURLOPT_RETURNTRANSFER =&gt; true
              );
              curl_setopt_array ( $ch, $options );
              $result = curl_exec ( $ch );
              if ($data = json_decode ( $result ) &amp; isset($data-&gt;running)) {
                $response [&quot;data&quot;] = $data-&gt;running;
              } else {
                $response [&quot;status&quot;] = &quot;error&quot;;
                $response [&quot;data&quot;] = $result;
                $response [&quot;error&quot;] = &quot;problem with status&quot;;
              }
            }
          } else {
            $response [&quot;status&quot;] = &quot;error&quot;;
            $response [&quot;error&quot;] = &quot;no valid json&quot;;
          }
          echo json_encode ( $response );
        } else {
          // only allow post
          header ( &quot;Location: &quot; . $configuration-&gt;url ( &quot;api&quot; ) );
        }
        exit ();
      } else {
        header ( &quot;Location: &quot; . $configuration-&gt;url ( &quot;processes&quot;) );
        exit ();
      }
    } else {
      header ( &quot;Location: &quot; . $configuration-&gt;url ( &quot;processes&quot;) );
    }
  } else {
    $smarty-&gt;assign ( &quot;_processesConfiguration&quot;, null );
    $smarty-&gt;assign ( &quot;_processesType&quot;, null );
  }
  
}

?&gt;</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>